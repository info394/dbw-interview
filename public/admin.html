<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Login | Interview System</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
<style>
body {
  font-family: 'Poppins', sans-serif;
  background: linear-gradient(135deg, #e0eafc, #cfdef3);
  text-align: center;
  margin: 0;
  padding: 60px 20px;
}
.login-box {
  background: white;
  max-width: 400px;
  margin: auto;
  padding: 40px;
  border-radius: 16px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.1);
}
input {
  width: 80%;
  padding: 10px;
  margin: 8px 0;
  border-radius: 8px;
  border: 1px solid #ccc;
  font-size: 14px;
}
button {
  background: #004a99;
  color: white;
  padding: 12px 20px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
}
button:hover { opacity: 0.85; }
#errorMsg { color: red; margin-top: 10px; }
</style>
</head>
<body>

<div class="login-box">
  <h2>Admin Access</h2>
  <input type="text" id="username" placeholder="Username" autofocus><br>
  <input type="password" id="password" placeholder="Password"><br>
  <button id="loginBtn">Log-In</button>
  <p id="errorMsg"></p>
</div>

<script>
const API_URL = '/api/login';

document.addEventListener("DOMContentLoaded", () => {
  const usernameInput = document.getElementById("username");
  const passwordInput = document.getElementById("password");
  const loginBtn = document.getElementById("loginBtn");
  const errorMsg = document.getElementById("errorMsg");

  // Only redirect if a valid token exists
  const token = localStorage.getItem("token");
  if(token) {
    window.location.href = "interview.html";
    return;
  }

  function clearError() { errorMsg.textContent = ""; }

  async function login() {
    clearError();
    const username = usernameInput.value.trim();
    const password = passwordInput.value.trim();

    if(!username || !password) {
      errorMsg.textContent = "Please enter both username and password.";
      return;
    }

    try {
      const res = await fetch(API_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, password })
      });

      if(!res.ok) throw new Error("Network error");

      const data = await res.json();

      if(data.success) {
        localStorage.setItem("token", data.token);
        window.location.href = "interview.html";
      } else {
        errorMsg.textContent = "Invalid credentials.";
      }

    } catch(err) {
      console.error(err);
      errorMsg.textContent = "Server error, please try again later.";
    }
  }

  loginBtn.addEventListener("click", login);

  // Only trigger login on Enter if focus is inside inputs
  [usernameInput, passwordInput].forEach(input => {
    input.addEventListener("keydown", (e) => {
      if(e.key === "Enter") login();
    });
  });
});
</script>

</body>
</html>
