<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>INTERVIEW | Applicant Profiles</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
<style>
body { font-family: 'Poppins', sans-serif; background: #e0eafc; padding: 20px; margin: 0; text-align: center; }
h1 { color: #004a99; margin-bottom: 10px; }
h2.subheading, h3.subheading { color: #004a99; font-weight: 400; margin: 5px 0; font-size: 18px; }
h3.subheading { padding-bottom: 30px; }
#breadcrumb { margin: 10px 0; font-size:14px; color:#004a99; }
.btn {
  padding: 14px 22px;
  margin: 5px;
  font-size: 16px;
  font-weight: 600;
  border-radius: 10px;
  border: none;
  cursor: pointer;
  transition: background 0.3s ease, box-shadow 0.3s ease, transform 0.2s ease;
}
.btn-category { background: #004a99; color: white; }
.btn-year, .btn-month { background: #0066cc; color: white; }
.btn-date { background: #66ccff; color: white; }
.btn-active { background: white !important; color: #004a99 !important; border: 1px solid #004a99; }

/* Hover effect for all buttons */
.btn:hover {
  opacity: 0.85;
  transform: scale(1.05);
  box-shadow: 0 4px 12px rgba(0, 74, 153, 0.3);
}

.section { margin-top: 20px; display: none; }
.date-input-container { margin-top: 20px; }
.date-input { padding: 6px; width: 150px; font-size: 14px; margin-right: 6px; }

/* Updated Add Date Button */
#addDateBtn {
  background: linear-gradient(135deg, #007bff, #004a99);
  box-shadow: 0 4px 8px rgba(0, 74, 153, 0.4);
  border-radius: 12px;
  padding: 14px 22px;
  color: white;
  font-weight: 600;
  font-size: 16px;
  cursor: pointer;
  border: none;
  transition: background 0.3s ease, box-shadow 0.3s ease, transform 0.2s ease;
}
#addDateBtn:hover {
  background: linear-gradient(135deg, #0056b3, #003366);
  box-shadow: 0 6px 12px rgba(0, 74, 153, 0.6);
  transform: scale(1.05);
}

.added-date {
  display: inline-block;
  background: #66ccff;
  color: #004a99;
  padding: 4px 8px;
  margin: 4px;
  border-radius: 6px;
  cursor: default;
  user-select: none;
}

  .date-delete {
  margin-left: 6px;
  font-weight: 700;
  font-size: 10px;
  color: red;
  cursor: pointer;
}


.profiles-wrapper { display: flex; flex-wrap: wrap; justify-content: flex-start; margin-top: 20px; }
.profile-container { background: #ffffff; border-radius: 8px; padding: 12px; margin: 5px; width: 300px; text-align: left; font-size: 12px; box-shadow: 2px 2px 8px #cbd8e6, -2px -2px 8px #f7faff; }
.profile-title {
  font-weight: 600;
  color: #004a99;
  margin-bottom: 6px;
  text-align: left;
  padding-left: 2px;
}
.profile-table { width: 100%; border-collapse: collapse; }
.profile-table td { padding: 4px 6px; }
.label { width: 40%; font-weight: 500; color: #004a99; text-align: left; }
.editable { background-color: #f7faff; border-radius: 4px; padding: 4px 6px; width: 95%; border: 1px solid transparent; display:inline-block; }
.editable:focus { border: 1px solid #ff944d; outline: none; background-color: #fffefc; }
select { padding: 4px 6px; border-radius:6px; border:none; cursor:pointer; background:rgb(0, 153, 255); color:white; width:100%; }
.time-input { background:yellow; width:95%; padding:4px; border-radius:4px; border:none; color:black; }

#addMoreBtn { margin-top: 10px; }
#saveBtn, #clearBtn, #logoutBtn {
  margin-top: 20px;
  padding: 10px 20px;
  font-size: 14px;
  cursor: pointer;
  border-radius: 8px;
  border:none;
  color:white;
  transition: background 0.3s ease, box-shadow 0.3s ease, transform 0.2s ease;
}
#saveBtn { background:#004a99; }
#clearBtn { background:#cc3300; margin-left: 10px; }
#logoutBtn { background:#666666; margin-left: 10px; }

/* Additional hover for bottom buttons */
#saveBtn:hover, #clearBtn:hover, #logoutBtn:hover {
  opacity: 0.85;
  transform: scale(1.05);
  box-shadow: 0 4px 12px rgba(0, 74, 153, 0.3);
}
</style>
</head>
<body>

<h1>Applicant Profiles</h1>
<h2 class="subheading">DBW CORPORATION LLC</h2>
<h3 class="subheading">Manage and Review Applicant Details</h3>

<div id="breadcrumb"></div>
<div id="categoryContainer"></div>
<div id="yearContainer" class="section"></div>
<div id="monthContainer" class="section"></div>
<div id="dateContainer" class="section">
  <div class="date-input-container">
    <input type="text" placeholder="Enter Date (YYYY-MM-DD)" id="dateInput" class="date-input">
    <button id="addDateBtn" class="btn btn-month">Add Date</button>
  </div>
  <div id="addedDates" style="margin-top:10px;"></div>
</div>

<div id="profilesWrapper" class="profiles-wrapper"></div>
<button id="addMoreBtn" class="btn btn-month" style="display:none;">Add One More</button>
<button id="saveBtn">Save All</button>
<button id="clearBtn">Clear All</button>
<button id="logoutBtn">Logout</button>

<script>
// ðŸ”¹ CHECK ADMIN LOGIN
if (!localStorage.getItem("token")) {
  window.location.href = "admin.html";
}

// ðŸ”¹ API URL
const API_URL = 'https://dbw-interview.onrender.com/api/applicants';

const categories = ["PETRA","KEDMA","Logistics Manager","Logistics Assistant","Carpenter","Operations Supervisor","Electrician"];
const years = ["2025", "2026"];
const months = ["January","February","March","April","May","June","July","August","September","October","November","December"];
const nationalities = ["Algerian","Bhutanese","Cambodia","Cameroonian","Chad","Colombian","Congo","Ethiopian","Filipina","Gabonese","Ghana","Guinean","Indian","Indonesian","Ivorian","Kenyan","Myanmar","Nepalese","Nigerian","South African","Sierra Leone","Sri Lankan","Tanzanian","Ugandan","Zimbabwe"];
const educationList = ["Master's","Bachelor's","Bachelor's Diploma","High School","College Diploma","College","College Undergraduate","High School Diploma","Diploma","Certificate","University"];

let interviewData = {};

const categoryContainer = document.getElementById("categoryContainer");
const yearContainer = document.getElementById("yearContainer");
const monthContainer = document.getElementById("monthContainer");
const dateContainer = document.getElementById("dateContainer");
const addedDatesDiv = document.getElementById("addedDates");
const profilesWrapper = document.getElementById("profilesWrapper");
const breadcrumbDiv = document.getElementById("breadcrumb");
const addMoreBtn = document.getElementById("addMoreBtn");
const clearBtn = document.getElementById("clearBtn");
const logoutBtn = document.getElementById("logoutBtn");

let selectedCategory = null, selectedYear = null, selectedMonth = null, selectedDate = null;

// ðŸ”¹ LOAD APPLICANTS
async function loadFromServer() {
  try {
    const res = await fetch(API_URL);
    const data = await res.json();
    interviewData = {};
    data.forEach(item => {
      if(!interviewData[item.category]) interviewData[item.category]={};
      if(!interviewData[item.category][item.year]) interviewData[item.category][item.year]={};
      if(!interviewData[item.category][item.year][item.month]) interviewData[item.category][item.year][item.month]={};
      if(!interviewData[item.category][item.year][item.month][item.date]) interviewData[item.category][item.year][item.month][item.date]=[];
      interviewData[item.category][item.year][item.month][item.date].push(item);
    });
    renderCategories();
  } catch(err) {
    console.error('Error fetching applicants:', err);
    alert('Cannot load applicants. Check backend URL and CORS.');
    renderCategories();
  }
}

// ðŸ”¹ SAVE/DELETE APPLICANTS
async function saveApplicantToServer(applicant) {
  try {
    await fetch(API_URL, {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify(applicant)
    });
  } catch(err) {
    console.error('Error saving applicant:', err);
  }
}
async function deleteDate(date) {
  if(!selectedCategory || !selectedYear || !selectedMonth || !date) return;
  if(!interviewData[selectedCategory] || !interviewData[selectedCategory][selectedYear] || !interviewData[selectedCategory][selectedYear][selectedMonth]) return;
  if(!interviewData[selectedCategory][selectedYear][selectedMonth][date]) return;
  
  // Remove from interviewData
  delete interviewData[selectedCategory][selectedYear][selectedMonth][date];
  if(Object.keys(interviewData[selectedCategory][selectedYear][selectedMonth]).length === 0) {
    delete interviewData[selectedCategory][selectedYear][selectedMonth];
  }
  
  // Remove from UI
  renderDates();
  renderProfiles();

  // TODO: Call backend to delete all for this date (if backend supports bulk delete)
  // For now, reload all or just ignore
  alert(`Deleted all applicants for date ${date}. Please refresh to sync with backend.`);
}

// ðŸ”¹ RENDER FUNCTIONS

function renderCategories() {
  categoryContainer.innerHTML = '';
  selectedCategory = null;
  selectedYear = null;
  selectedMonth = null;
  selectedDate = null;
  yearContainer.style.display = 'none';
  monthContainer.style.display = 'none';
  dateContainer.style.display = 'none';
  addedDatesDiv.innerHTML = '';
  profilesWrapper.innerHTML = '';
  addMoreBtn.style.display = 'none';
  breadcrumbDiv.textContent = 'Choose a category';
  categories.forEach(cat => {
    const btn = document.createElement('button');
    btn.textContent = cat;
    btn.className = 'btn btn-category';
    btn.onclick = () => {
      selectedCategory = cat;
      renderYears();
      updateBreadcrumb();
    };
    categoryContainer.appendChild(btn);
  });
}

function renderYears() {
  yearContainer.innerHTML = '';
  selectedYear = null;
  selectedMonth = null;
  selectedDate = null;
  monthContainer.style.display = 'none';
  dateContainer.style.display = 'none';
  addedDatesDiv.innerHTML = '';
  profilesWrapper.innerHTML = '';
  addMoreBtn.style.display = 'none';
  yearContainer.style.display = 'block';
  breadcrumbDiv.textContent = `Category: ${selectedCategory} > Choose a year`;
  years.forEach(year => {
    const btn = document.createElement('button');
    btn.textContent = year;
    btn.className = 'btn btn-year';
    btn.onclick = () => {
      selectedYear = year;
      renderMonths();
      updateBreadcrumb();
    };
    yearContainer.appendChild(btn);
  });
}

function renderMonths() {
  monthContainer.innerHTML = '';
  selectedMonth = null;
  selectedDate = null;
  dateContainer.style.display = 'none';
  addedDatesDiv.innerHTML = '';
  profilesWrapper.innerHTML = '';
  addMoreBtn.style.display = 'none';
  monthContainer.style.display = 'block';
  breadcrumbDiv.textContent = `Category: ${selectedCategory} > Year: ${selectedYear} > Choose a month`;
  months.forEach(month => {
    const btn = document.createElement('button');
    btn.textContent = month;
    btn.className = 'btn btn-month';
    btn.onclick = () => {
      selectedMonth = month;
      renderDates();
      updateBreadcrumb();
    };
    monthContainer.appendChild(btn);
  });
}

function renderDates() {
  addedDatesDiv.innerHTML = '';
  profilesWrapper.innerHTML = '';
  addMoreBtn.style.display = 'none';
  dateContainer.style.display = 'block';
  breadcrumbDiv.textContent = `Category: ${selectedCategory} > Year: ${selectedYear} > Month: ${selectedMonth} > Choose or add a date`;

  const datesObj = interviewData[selectedCategory]?.[selectedYear]?.[selectedMonth] || {};

  Object.keys(datesObj).sort().forEach(date => {
    addDateTag(date);
  });
}

function addDateTag(date) {
  const span = document.createElement('span');
  span.className = 'added-date';

  // Date text span (bold and normal size)
  const dateTextSpan = document.createElement('span');
  dateTextSpan.textContent = date;
  dateTextSpan.style.fontWeight = '700';
  dateTextSpan.style.fontSize = '14px';
  dateTextSpan.style.color = '#004a99';

const cross = document.createElement('span');
cross.textContent = 'x';
cross.className = 'date-delete';

  cross.textContent = 'âœ•';
  cross.style.marginLeft = '6px';
  cross.style.fontWeight = '700';
  cross.style.fontSize = '10px';
  cross.style.color = 'red';
  cross.style.cursor = 'pointer';

  cross.onclick = e => {
    e.stopPropagation();
    if(confirm(`Delete date ${date} and all applicants?`)) {
      deleteDate(date);
    }
  };

  // Clicking on date loads profiles
  span.onclick = () => {
    selectedDate = date;
    renderProfiles();
  };

  span.appendChild(dateTextSpan);
  span.appendChild(cross);

  addedDatesDiv.appendChild(span);
}

function renderProfiles() {
  profilesWrapper.innerHTML = '';
  addMoreBtn.style.display = 'none';
  if(!selectedCategory || !selectedYear || !selectedMonth || !selectedDate) {
    breadcrumbDiv.textContent = `Category: ${selectedCategory} > Year: ${selectedYear} > Month: ${selectedMonth} > Choose a date`;
    return;
  }
  const applicants = interviewData[selectedCategory]?.[selectedYear]?.[selectedMonth]?.[selectedDate] || [];
  breadcrumbDiv.textContent = `Category: ${selectedCategory} > Year: ${selectedYear} > Month: ${selectedMonth} > Date: ${selectedDate}`;

  if(applicants.length === 0) {
    profilesWrapper.textContent = "No applicants for this date.";
    return;
  }

  applicants.forEach((applicant, idx) => {
    const div = document.createElement('div');
    div.className = 'profile-container';

    div.innerHTML = `
      <div class="profile-title">${applicant.name}</div>
      <table class="profile-table">
        <tr><td class="label">Category:</td><td>${applicant.category}</td></tr>
        <tr><td class="label">Date:</td><td>${applicant.date}</td></tr>
        <tr><td class="label">Nationality:</td><td>${applicant.nationality}</td></tr>
        <tr><td class="label">Education:</td><td>${applicant.education}</td></tr>
        <tr><td class="label">Experience:</td><td>${applicant.experience} years</td></tr>
      </table>
    `;

    profilesWrapper.appendChild(div);
  });
}

// ADD DATE BUTTON LOGIC
document.getElementById('addDateBtn').onclick = () => {
  const dateInput = document.getElementById('dateInput');
  const date = dateInput.value.trim();
  if(!date) {
    alert("Please enter a date (YYYY-MM-DD)");
    return;
  }
  if(!selectedCategory || !selectedYear || !selectedMonth) {
    alert("Please select category, year and month first");
    return;
  }

  if(!interviewData[selectedCategory]) interviewData[selectedCategory] = {};
  if(!interviewData[selectedCategory][selectedYear]) interviewData[selectedCategory][selectedYear] = {};
  if(!interviewData[selectedCategory][selectedYear][selectedMonth]) interviewData[selectedCategory][selectedYear][selectedMonth] = {};
  if(!interviewData[selectedCategory][selectedYear][selectedMonth][date]) {
    interviewData[selectedCategory][selectedYear][selectedMonth][date] = [];
    addDateTag(date);
    dateInput.value = '';
    alert(`Date ${date} added.`);
  } else {
    alert(`Date ${date} already exists.`);
  }
};

// INITIALIZE
loadFromServer();

clearBtn.onclick = () => {
  if(confirm("Clear all stored data?")) {
    localStorage.clear();
    location.reload();
  }
};

logoutBtn.onclick = () => {
  localStorage.removeItem("token");
  location.href = "admin.html";
};

</script>
</body>
</html>

