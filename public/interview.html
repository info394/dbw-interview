<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>INTERVIEW | Applicant Profiles</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
<style>
/* ðŸ”¹ GENERAL STYLES */
body { font-family: 'Poppins', sans-serif; background: #e0eafc; padding: 20px; margin: 0; text-align: center; display:none; }
h1 { color: #004a99; margin-bottom: 10px; }
h2.subheading, h3.subheading { color: #004a99; font-weight: 400; margin: 5px 0; font-size: 18px; }
h3.subheading { padding-bottom: 30px; }
#breadcrumb { margin: 10px 0; font-size:14px; color:#004a99; }
/* ðŸ”¹ BUTTONS */
.btn {
  padding: 14px 22px;
  margin: 5px;
  font-size: 16px;
  font-weight: 600;
  border-radius: 10px;
  border: none;
  cursor: pointer;
  transition: 0.3s;
}

.btn:hover {
  opacity: 0.9;
  box-shadow: 0 4px 12px rgba(0, 74, 153, 0.3);
  transform: translateY(-2px);
}

.btn-category { background: #004a99; color: white; }
.btn-year, .btn-month { background: #0066cc; color: white; }
.btn-date { background: #66ccff; color: white; }
.btn-active { background: white !important; color: #004a99 !important; border: 1px solid #004a99; }
.btn:hover { opacity: 0.8; }
.section { margin-top: 20px; display: none; }
.date-input-container { margin-top: 20px; }
.date-input { padding: 6px; width: 150px; font-size: 14px; margin-right: 6px; }
.profiles-wrapper { display: flex; flex-wrap: wrap; justify-content: flex-start; margin-top: 20px; }
.profile-container { background: #ffffff; border-radius: 8px; padding: 12px; margin: 5px; width: 300px; text-align: left; font-size: 12px; box-shadow: 2px 2px 8px #cbd8e6, -2px -2px 8px #f7faff; }
.profile-table { width: 100%; border-collapse: collapse; }
.profile-table td { padding: 4px 6px; }
.label { width: 40%; font-weight: 500; color: #004a99; text-align: left; }
.editable { background-color: #f7faff; border-radius: 4px; padding: 4px 6px; width: 95%; border: 1px solid transparent; display:inline-block; }
.editable:focus { border: 1px solid #ff944d; outline: none; background-color: #fffefc; }
select { padding: 4px 6px; border-radius:6px; border:none; cursor:pointer; background:rgb(0, 153, 255); color:white; width:100%; }
.time-input { background:yellow; width:95%; padding:4px; border-radius:4px; border:none; color:black; }
  
#addMoreBtn { margin-top: 10px; }
#saveBtn, #clearBtn, #logoutBtn { margin-top: 20px; padding: 10px 20px; font-size: 14px; cursor: pointer; border-radius: 8px; border:none; color:white; }
#saveBtn { background:#004a99; }
#clearBtn { background:#cc3300; margin-left: 10px; }
#logoutBtn { background:#666666; margin-left: 10px; }
</style>
</head>
<body>

<h1>Applicant Profiles</h1>
<h2 class="subheading">DBW CORPORATION LLC</h2>
<h3 class="subheading">Manage and Review Applicant Details</h3>

<div id="breadcrumb"></div>
<div id="categoryContainer"></div>
<div id="yearContainer" class="section"></div>
<div id="monthContainer" class="section"></div>
<div id="dateContainer" class="section">
  <div class="date-input-container">
    <input type="text" placeholder="Enter Date (YYYY-MM-DD)" id="dateInput" class="date-input">
    <button id="addDateBtn" class="btn btn-month">Add Date</button>
  </div>
</div>

<div id="profilesWrapper" class="profiles-wrapper"></div>
<button id="addMoreBtn" class="btn btn-month" style="display:none;">Add One More</button>
<button id="saveBtn">Save All</button>
<button id="clearBtn">Clear All</button>
<button id="logoutBtn">Logout</button>

<script>
// ðŸ”¹ CHECK LOGIN FIRST
if (!localStorage.getItem("token")) {
  window.location.href = "admin.html";
} else {
  // show the content after token check
  document.body.style.display = 'block';
}

// ðŸ”¹ API URL
const API_URL = 'https://dbw-interview.onrender.com/api/applicants';

const categories = ["PETRA","KEDMA","Logistics Manager","Logistics Assistant","Carpenter","Operations Supervisor","Electrician"];
const years = ["2025", "2026"];
const months = ["January","February","March","April","May","June","July","August","September","October","November","December"];
const nationalities = ["Algerian","Bhutanese","Cambodia","Cameroonian","Chad","Colombian","Congo","Ethiopian","Filipina","Gabonese","Ghana","Guinean","Indian","Indonesian","Ivorian","Kenyan","Myanmar","Nepalese","Nigerian","South African","Sierra Leone","Sri Lankan","Tanzanian","Ugandan","Zimbabwe"];
const educationList = ["Master's","Bachelor's","Bachelor's Diploma","High School","College Diploma","College","College Undergraduate","High School Diploma","Diploma","Certificate","University"];

let interviewData = {};

const categoryContainer = document.getElementById("categoryContainer");
const yearContainer = document.getElementById("yearContainer");
const monthContainer = document.getElementById("monthContainer");
const dateContainer = document.getElementById("dateContainer");
const profilesWrapper = document.getElementById("profilesWrapper");
const breadcrumbDiv = document.getElementById("breadcrumb");
const addMoreBtn = document.getElementById("addMoreBtn");
const clearBtn = document.getElementById("clearBtn");
const logoutBtn = document.getElementById("logoutBtn");

let selectedCategory = null, selectedYear = null, selectedMonth = null, selectedDate = null;

// ðŸ”¹ LOAD APPLICANTS
async function loadFromServer() {
  try {
    const res = await fetch(API_URL);
    const data = await res.json();
    interviewData = {};
    data.forEach(item => {
      if(!interviewData[item.category]) interviewData[item.category]={};
      if(!interviewData[item.category][item.year]) interviewData[item.category][item.year]={};
      if(!interviewData[item.category][item.year][item.month]) interviewData[item.category][item.year][item.month]={};
      if(!interviewData[item.category][item.year][item.month][item.date]) interviewData[item.category][item.year][item.month][item.date]=[];
      interviewData[item.category][item.year][item.month][item.date].push(item);
    });
    renderCategories();
  } catch(err) {
    console.error('Error fetching applicants:', err);
    alert('Cannot load applicants. Check backend URL and CORS.');
    renderCategories(); // still show categories
  }
}

// ðŸ”¹ SAVE/DELETE APPLICANTS
async function saveApplicantToServer(applicant) {
  await fetch(API_URL, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(applicant)
  });
}
async function deleteApplicantFromServer(id) {
  await fetch(`${API_URL}/${id}`, { method: 'DELETE' });
}

// ... (keep all previous functions for rendering categories, years, months, applicants)

// ðŸ”¹ ADDITION: Hide content until verified
window.addEventListener('DOMContentLoaded', ()=>{
  if(localStorage.getItem("token")){
    document.body.style.display='block';
  }
});
</script>
</body>
</html>

