<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>INTERVIEW | Applicant Profiles</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
<style>
body { font-family: 'Poppins', sans-serif; background: #e0eafc; padding: 20px; margin: 0; text-align: center; position: relative; }
h1 { color: #004a99; margin-bottom: 10px; }
h2.subheading, h3.subheading { color: #004a99; font-weight: 400; margin: 5px 0; font-size: 18px; }
h3.subheading { padding-bottom: 30px; }
#breadcrumb { margin: 10px 0; font-size:14px; color:#004a99; }

.btn { padding: 14px 22px; margin: 5px; font-size: 16px; font-weight: 600; border-radius: 10px; border: none; cursor: pointer; transition: 0.3s; }
.btn-category { background: #004a99; color: white; }
.btn-year, .btn-month { background: #0066cc; color: white; }
.btn-date { position: relative; background: #66ccff; color: white; border-radius: 12px; margin: 5px; padding: 10px 20px; display: inline-block; }
.date-x { position: absolute; top: -6px; right: -6px; background: red; color: white; border-radius: 50%; font-size: 10px; padding: 2px 5px; cursor: pointer; }
.btn:hover { opacity: 0.8; }

.section { margin-top: 20px; display: none; }
.date-input-container { margin-top: 20px; }
.date-input { padding: 6px; width: 150px; font-size: 14px; margin-right: 6px; }

.profiles-wrapper { display: flex; flex-wrap: wrap; justify-content: flex-start; margin-top: 20px; }
.profile-container { background: #ffffff; border-radius: 8px; padding: 12px; margin: 5px; width: 300px; text-align: left; font-size: 12px; box-shadow: 2px 2px 8px #cbd8e6, -2px -2px 8px #f7faff; position: relative; }
.profile-label { font-weight: 600; color: #004a99; margin-bottom: 8px; font-size: 14px; }

.profile-table { width: 100%; border-collapse: collapse; }
.profile-table td { padding: 4px 6px; }
.label { width: 40%; font-weight: 500; color: #004a99; text-align: left; }

.editable { background-color: #f7faff; border-radius: 4px; padding: 4px 6px; width:95%; border: 1px solid transparent; display:inline-block; }
.editable:focus { border: 1px solid #ff944d; outline: none; background-color: #fffefc; }

select { padding: 4px 6px; border-radius:6px; border:none; cursor:pointer; background:rgb(0, 153, 255); color:white; width:100%; }
.time-input { background:yellow; width:95%; padding:4px; border-radius:4px; border:none; color:black; }
.notes-input { width:95%; border-radius:4px; padding:4px; border:1px solid #ccc; resize:vertical; min-height:40px; }

.save-btn, .remove-btn {
  margin-top: 6px; padding: 6px 10px; border: none; border-radius: 6px; cursor: pointer;
  color: white; font-size: 12px; font-weight: 600;
}
.save-btn { background: #004a99; }
.remove-btn { background: #cc3300; margin-left: 6px; }

#addMoreBtn { margin-top: 10px; }
#saveBtn, #clearBtn { margin-top: 20px; padding: 10px 20px; font-size: 14px; cursor: pointer; border-radius: 8px; border:none; color:white; }
#saveBtn { background:#004a99; }
#clearBtn { background:#cc3300; margin-left: 10px; }

#searchContainer { position: absolute; top: 20px; right: 20px; }
#searchInput { padding:6px; width:200px; border-radius:6px; border:1px solid #ccc; }
</style>
</head>
<body>

<div id="searchContainer">
  <input type="text" id="searchInput" placeholder="Search applicant...">
  <button id="searchBtn" class="btn btn-category">Search</button>
</div>

<h1>Applicant Profiles</h1>
<h2 class="subheading">DBW CORPORATION LLC</h2>
<h3 class="subheading">Manage and Review Applicant Details</h3>

<div id="breadcrumb"></div>
<div id="categoryContainer"></div>
<div id="yearContainer" class="section"></div>
<div id="monthContainer" class="section"></div>
<div id="dateContainer" class="section">
  <div class="date-input-container">
    <input type="text" placeholder="Enter Date" id="dateInput" class="date-input">
    <button id="addDateBtn" class="btn btn-month">Add Date</button>
  </div>
  <div id="dateButtonsContainer" style="margin-top:10px;"></div>
</div>

<div id="profilesWrapper" class="profiles-wrapper"></div>
<button id="addMoreBtn" class="btn btn-month" style="display:none;">Add One More</button>
<button id="saveBtn">Save All</button>
<button id="clearBtn">Clear All</button>

<script>
const API_URL = 'https://dbw-interview.onrender.com/api/applicants';
const categories=["PETRA","KEDMA","Logistics Manager","Logistics Assistant","Carpenter","Operations Supervisor","Electrician"];
const years=["2025","2026"];
const months=["January","February","March","April","May","June","July","August","September","October","November","December"];
const nationalities=["Algerian","Bhutanese","Cambodia","Cameroonian","Chad","Colombian","Congo","Ethiopian","Filipina","Gabonese","Ghana","Guinean","Indian","Indonesian","Ivorian","Kenyan","Myanmar","Nepalese","Nigerian","South African","Sierra Leone","Sri Lankan","Tanzanian","Ugandan","Zimbabwe"];
const educationList=["Master's","Bachelor's","Bachelor's Diploma","High School","College Diploma","College","College Undergraduate","High School Diploma","Diploma","Certificate","University"];

let interviewData = {};
let selectedCategory=null, selectedYear=null, selectedMonth=null, selectedDate=null;
const categoryContainer=document.getElementById("categoryContainer");
const yearContainer=document.getElementById("yearContainer");
const monthContainer=document.getElementById("monthContainer");
const dateContainer=document.getElementById("dateContainer");
const profilesWrapper=document.getElementById("profilesWrapper");
const breadcrumbDiv=document.getElementById("breadcrumb");
const addMoreBtn=document.getElementById("addMoreBtn");

// 🔍 Search function
document.getElementById("searchBtn").onclick=()=>{
  const query=document.getElementById("searchInput").value.toLowerCase();
  const cards=document.querySelectorAll(".profile-container");
  cards.forEach(c=>{
    const text=c.innerText.toLowerCase();
    c.style.display=text.includes(query)?"block":"none";
  });
};

async function loadFromServer(){
  try{
    const res=await fetch(API_URL);
    const data=await res.json();
    interviewData={};
    data.forEach(item=>{
      if(!interviewData[item.category]) interviewData[item.category]={};
      if(!interviewData[item.category][item.year]) interviewData[item.category][item.year]={};
      if(!interviewData[item.category][item.year][item.month]) interviewData[item.category][item.year][item.month]={};
      if(!interviewData[item.category][item.year][item.month][item.date]) interviewData[item.category][item.year][item.month][item.date]=[];
      interviewData[item.category][item.year][item.month][item.date].push(item);
    });
    renderCategories();
  }catch(e){ renderCategories(); }
}

function updateBreadcrumb(){
  const crumbs=[];
  if(selectedCategory) crumbs.push(`<span onclick="goBack('category')" style="cursor:pointer;">${selectedCategory}</span>`);
  if(selectedYear) crumbs.push(`<span onclick="goBack('year')" style="cursor:pointer;">${selectedYear}</span>`);
  if(selectedMonth) crumbs.push(`<span onclick="goBack('month')" style="cursor:pointer;">${selectedMonth}</span>`);
  if(selectedDate) crumbs.push(`<span onclick="goBack('date')" style="cursor:pointer;">${selectedDate}</span>`);
  breadcrumbDiv.innerHTML=crumbs.join(" > ");
}

function goBack(level){
  if(level==='category'){ selectedCategory=selectedYear=selectedMonth=selectedDate=null; }
  else if(level==='year'){ selectedYear=selectedMonth=selectedDate=null; }
  else if(level==='month'){ selectedMonth=selectedDate=null; }
  else if(level==='date'){ selectedDate=null; }
  profilesWrapper.innerHTML=''; addMoreBtn.style.display='none';
  yearContainer.style.display=monthContainer.style.display=dateContainer.style.display='none';
  renderCategories(); if(selectedCategory) renderYears(); if(selectedYear) renderMonths(); updateBreadcrumb();
}

// ✅ Category toggle logic
function renderCategories(){
  categoryContainer.innerHTML='';
  categories.forEach(c=>{
    const b=document.createElement('button');
    b.textContent=c;
    b.className='btn btn-category';
    b.onclick=()=>{
      if(selectedCategory===c){
        selectedCategory=null;
        yearContainer.style.display='none';
        categoryContainer.querySelectorAll('.btn').forEach(btn=>btn.style.display='inline-block');
      } else {
        selectedCategory=c;
        yearContainer.style.display='block';
        renderYears();
        categoryContainer.querySelectorAll('.btn').forEach(btn=>{
          btn.style.display = btn.textContent===c ? 'inline-block' : 'none';
        });
      }
      updateBreadcrumb();
    };
    categoryContainer.appendChild(b);
  });
}

function renderYears(){
  yearContainer.innerHTML='';
  years.forEach(y=>{
    const b=document.createElement('button');
    b.textContent=y;
    b.className='btn btn-year';
    b.onclick=()=>{ selectedYear=y; monthContainer.style.display='block'; renderMonths(); updateBreadcrumb(); };
    yearContainer.appendChild(b);
  });
}

function renderMonths(){
  monthContainer.innerHTML='';
  months.forEach(m=>{
    const b=document.createElement('button');
    b.textContent=m;
    b.className='btn btn-month';
    b.onclick=()=>{ selectedMonth=m; dateContainer.style.display='block'; updateBreadcrumb(); };
    monthContainer.appendChild(b);
  });
}

// ✅ Add date button logic
document.getElementById('addDateBtn').onclick=()=>{
  const dateVal=document.getElementById('dateInput').value.trim();
  if(!dateVal){ alert('Enter a date'); return; }

  const dateBtn=document.createElement('div');
  dateBtn.className='btn btn-date';
  dateBtn.textContent=dateVal;

  const x=document.createElement('span');
  x.className='date-x';
  x.textContent='×';
  x.onclick=(e)=>{ e.stopPropagation(); if(confirm('Delete this date?')) dateBtn.remove(); };
  dateBtn.appendChild(x);

  dateBtn.onclick=()=>{
    selectedDate=dateVal;
    addMoreBtn.style.display='block';
    profilesWrapper.innerHTML='';
    updateBreadcrumb();

    if(interviewData[selectedCategory] && interviewData[selectedCategory][selectedYear] &&
       interviewData[selectedCategory][selectedYear][selectedMonth] &&
       interviewData[selectedCategory][selectedYear][selectedMonth][selectedDate]){
         interviewData[selectedCategory][selectedYear][selectedMonth][selectedDate].forEach(a=>{
           profilesWrapper.appendChild(createApplicantDiv(a));
         });
    }
  };

  document.getElementById('dateButtonsContainer').appendChild(dateBtn);
  document.getElementById('dateInput').value='';
};

// ✅ Applicant Card
function createApplicantDiv(app){
  const div=document.createElement('div');
  div.className='profile-container';
  div.innerHTML=`
    <div class="profile-label">Applicant</div>
    <table class="profile-table">
      <tr><td class="label">Name:</td><td><span class="editable" contenteditable="true">${app.name||''}</span></td></tr>
      <tr><td class="label">Visa:</td><td><span class="editable" contenteditable="true">${app.visa||''}</span></td></tr>
      <tr><td class="label">Nationality:</td><td><select class="nationality-select">${nationalities.map(n=>`<option ${app.nationality===n?'selected':''}>${n}</option>`).join('')}</select></td></tr>
      <tr><td class="label">Salary:</td><td><span class="editable" contenteditable="true">${app.salary||''}</span></td></tr>
      <tr><td class="label">Education:</td><td><select class="education-select">${educationList.map(e=>`<option ${app.education===e?'selected':''}>${e}</option>`).join('')}</select></td></tr>
      <tr><td class="label">Contact:</td><td><span class="editable" contenteditable="true">${app.contact||''}</span></td></tr>
      <tr><td class="label">Email:</td><td><span class="editable" contenteditable="true">${app.email||''}</span></td></tr>
      <tr><td class="label">Time:</td><td><input type="time" class="time-input" value="${app.time||''}"></td></tr>
      <tr><td class="label">Status:</td><td><select class="status-select"><option>Accepted</option><option>Rejected</option><option>Hold</option></select></td></tr>
      <tr><td class="label">Notes:</td><td><textarea class="notes-input">${app.notes||''}</textarea></td></tr>
    </table>
    <button class="save-btn">Save</button>
    <button class="remove-btn">Remove</button>
  `;
  div.querySelector('.status-select').value=app.status||'Accepted';

  div.querySelector('.save-btn').onclick=()=>{
    alert('Applicant data saved temporarily.');
  };
  div.querySelector('.remove-btn').onclick=()=>{ div.remove(); };

  return div;
}

// ✅ Add applicant
addMoreBtn.onclick=()=>{
  if(!selectedCategory||!selectedYear||!selectedMonth||!selectedDate) return;
  const newApp={category:selectedCategory,year:selectedYear,month:selectedMonth,date:selectedDate};
  profilesWrapper.appendChild(createApplicantDiv(newApp));
};

loadFromServer();
</script>
</body>
</html>
